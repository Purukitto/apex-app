---
description: Standards for animations, polish, and "Dark Cockpit" UX refinement
globs: ["src/components/**/*.tsx", "src/pages/**/*.tsx"]
alwaysApply: true
---

# Apex UX & Polish Standards

## 1. Motion & Transitions (Framer Motion)

### Shared Animation Library
- **MANDATORY**: Import animation variants and props from `src/lib/animations.ts`
- **DO NOT** define animation variants inline - always use the shared library for consistency.
- **Available exports:**
  - `containerVariants` - For page-level containers with staggered children
  - `itemVariants` - For individual items (0.5s duration, y: 20 offset)
  - `fastItemVariants` - For faster animations (0.3s duration, y: 10 offset)
  - `listContainerVariants` - For lists with 0.05s stagger
  - `buttonHoverProps` - Standard button hover/tap animations
  - `cardHoverProps` - Standard card border hover effect

### Staggered Entry Animations
- **MANDATORY**: All pages must use staggered entry animations for their main content.
- **Usage:**
  ```typescript
  import { containerVariants, itemVariants, buttonHoverProps } from '../lib/animations';
  
  // In component:
  <motion.div
    variants={containerVariants}
    initial="hidden"
    animate="visible"
  >
    <motion.h1 variants={itemVariants}>Page Title</motion.h1>
    <motion.button {...buttonHoverProps}>Click</motion.button>
  </motion.div>
  ```
- **Lists and Cards:** Must use `staggerChildren` (0.05s - 0.1s) to reveal items sequentially.
- **Page Wrapper:** Wrap page content in `<motion.div>` with `variants={containerVariants}` and `initial="hidden" animate="visible"`.

### Micro-Interactions
- **Buttons:** **MANDATORY** Use `{...buttonHoverProps}` from animations library (spreads `whileHover` and `whileTap`).
- **Cards:** **MANDATORY** Use `{...cardHoverProps}` from animations library for border hover effect.
- **Page Transitions:** MainLayout uses `AnimatePresence` for smooth exit/entry between views.

## 2. Component Standards

### 2.1 Data Entry Modals (Keyboard-Safe)
- **MANDATORY**: All data-entry modals (forms with inputs/textarea/select) must be keyboard-safe on mobile.
- **Implementation pattern (see `AddBikeModal`):**
  - Use `useKeyboard()` from `src/hooks/useKeyboard`.
- Keep the modal container fixed and scroll only the inner form body (fields/results).
- Use a full-screen wrapper for safe-area padding, but avoid scrolling the entire modal.
  - Apply safe-area padding and dynamic bottom padding when keyboard is visible.
  - Attach a `focusin` handler on the form to scroll the active field into view.
  - Keep content centered with `mx-auto my-8` and avoid over-styling for tiny/simple modals.
- **Do NOT** apply this to simple confirmation/alert modals without inputs.

### Card Components
- **MANDATORY**: Always use the `Card` component from `src/components/ui/Card.tsx` for all card instances.
- **NEVER** create inline card styling with `bg-gradient-to-br`, `border`, etc. - use the `Card` component instead.
- **Card Look:** Raised, rounded-2xl, subtle dark gradient, soft border, and a gentle shadow for depth.
- **Usage:**
 ```typescript
 import { Card } from '../components/ui/Card';
 
 // Basic card
 <Card padding="md">
   <h3>Card Title</h3>
   <p>Content</p>
 </Card>
 
 // Clickable card
 <Card padding="sm" clickable onClick={handleClick}>
   <h3>Clickable Card</h3>
 </Card>
 
 // With custom animation
 <Card padding="md" animate="item" variants={customVariants}>
   <h3>Custom Animation</h3>
 </Card>
 ```
- **Props:**
  - `padding`: `'sm'` (p-4), `'md'` (p-6), or `'lg'` (p-8) - default: `'md'`
  - `clickable`: boolean - adds cursor-pointer and group classes
  - `animate`: `'none'` | `'item'` | `'fastItem'` - default: `'fastItem'`
  - `hover`: boolean - enable/disable hover border effect - default: `true`
  - `variants`: Custom framer-motion variants (overrides animate)
  - All standard `motion.div` props are supported (onClick, className, etc.)

- **Icon Containers:**
  - Background: `bg-apex-green/10`
  - Hover: `group-hover:bg-apex-green/20`
  - Padding: `p-2` or `p-1.5` for smaller icons
  - Rounded: `rounded-md`
  - **Note**: Icon containers are NOT cards - use inline styling for icon containers within cards.

- **Action Buttons:**
  - Desktop: Hidden by default, show on group-hover: `opacity-100 md:opacity-0 md:group-hover:opacity-100`
  - Mobile: Always visible: `opacity-100`
  - Must use framer-motion scale feedback

### Page Structure
- **MANDATORY**: All pages must:
  1. Import animation variants from `src/lib/animations.ts`
  2. Wrap content in `<motion.div>` with `variants={containerVariants}` and `initial="hidden" animate="visible"`
  3. Apply `itemVariants` to page header/title
  4. Apply `containerVariants` to lists/grids of items
  5. Apply `itemVariants` or `fastItemVariants` to each list item
  6. Use `{...buttonHoverProps}` for all buttons
  7. Use `{...cardHoverProps}` for all cards

### Consistency Rules
- **All cards must use the `Card` component:** No inline card styling - always use `Card` from `src/components/ui/Card.tsx`.
- **All buttons must use `{...buttonHoverProps}`:** No inline animation definitions.
- **All lists must have staggered animations:** Use `listContainerVariants` and `fastItemVariants` for list items.
- **No duplicate animation code:** Always import from `src/lib/animations.ts`.
- **Exception:** Only use inline card styling if the `Card` component cannot accommodate the specific use case (e.g., special layouts, complex nested structures). Document why inline styling was necessary.

### Custom Dropdowns
- **MANDATORY**: For non-native dropdowns, use a button + popover pattern with `AnimatePresence`.
- **Layering**: Use `z-50` (or higher) and `bg-apex-black` with `border-apex-green/40`.
- **Typography**: Use `font-mono` for values and options.
- **Interaction**: Apply `{...buttonHoverProps}` on the trigger and options.

## 3. Visual Hierarchy & Polish
- **Borders over Shadows:** Avoid heavy shadows. Use subtle raised shadows only for cards and rely on `border-apex-white/10` or `border-apex-white/20` for structure.
- **Typography:**
  - Header: `font-sans font-bold tracking-tight`.
  - Telemetry: Always `font-mono text-apex-green`.
  - Card Titles: `font-semibold` for consistency.
- **Empty States:** Never show a blank screen. Use minimalist line-art or subtle Lucide icons with "muted" text.
- **Skeleton Loaders:** Use "Shimmer" effects (`.animate-shimmer`) for data fetching instead of generic loading spinners.

## 3.1 Color Theming Standards
- **MANDATORY**: Never use hardcoded hex colors in components. Always use theme colors from CSS variables.
- **Theme Colors Available:**
  - `apex-black`: `#0A0A0A` - Primary background
  - `apex-white`: `#f5f5dc` - Primary text
  - `apex-green`: `#3DBF6F` - Primary accent (data, success, active states)
  - `apex-red`: `#E35B5B` - Error, warning, danger states
- **Usage:**
  - **Tailwind Classes:** Prefer `text-apex-green`, `bg-apex-red`, etc. when possible.
  - **CSS Variables:** For SVG or inline styles, use `getComputedStyle(document.documentElement).getPropertyValue('--color-apex-green')` or access via `var(--color-apex-green)`.
  - **SVG Elements:** Use CSS variables or `currentColor` with Tailwind classes on parent.
- **Color Transitions:** When colors change based on state (e.g., lean angle), use smooth transitions (0.3s ease-in-out).
- **Deprecated Colors:**
  - **DO NOT** use `NEON_LIME` (`#bef264`) or any other hardcoded green colors. Always use `apex-green` instead.
  - **DO NOT** use `zinc-*` or other Tailwind color utilities for backgrounds/borders. Use `apex-black`, `apex-white`, `apex-green`, or `apex-red` with appropriate opacity modifiers.
  - **DO NOT** use generic `white`, `black`, `red-*`, `green-*` classes. Always use the `apex-*` prefixed theme colors.

## 3.2 Icon Standards
- **ApexTelemetryIcon:**
  - **MANDATORY**: Use `ApexTelemetryIcon` as the primary app logo/icon throughout the application.
  - **Visibility:** Icon is optimized for small sizes with responsive stroke width and dot size.
  - **Static Mode:** Use `static` prop for navigation/headers where tracking animations aren't needed.
  - **Animated Mode:** Use without `static` prop in Recorder/Ride pages for live telemetry feedback.
  - **Sizing:** Icon automatically scales stroke width and dot size based on `size` prop for optimal visibility.
  - **Background:** Always includes rounded background (`#0A0A0A`) for contrast, especially important at small sizes.
- **Icon Visibility Guidelines:**
  - Minimum stroke width: 2.5px (scales with icon size)
  - Minimum dot radius: 3.5px (scales with icon size)
  - Background always rendered for contrast
  - Subtle border on very small sizes (< 40px) for definition

## 4. QoL (Quality of Life)
- **Haptic Feedback:** On mobile (Capacitor), trigger light haptics for "Start Ride" or "Save" actions.
- **Pull-to-Refresh:** Implement standard mobile refresh gestures for the Garage and Dashboard feeds.