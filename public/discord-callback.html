<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discord Connected</title>
    <style>
      body {
        font-family: system-ui, -apple-system, sans-serif;
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100vh;
        margin: 0;
        background: #0A0A0A;
        color: #E2E2E2;
      }
      .container {
        text-align: center;
        padding: 2rem;
      }
      .success {
        color: #00FF41;
        font-size: 1.5rem;
        margin-bottom: 1rem;
      }
      .error {
        color: #FF3B30;
        font-size: 1.5rem;
        margin-bottom: 1rem;
      }
      .loading {
        color: #E2E2E2;
        font-size: 1rem;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div id="status" class="loading">Processing...</div>
      <p id="message">Please wait...</p>
    </div>
    <script>
      // Get URL parameters
      const urlParams = new URLSearchParams(window.location.search);
      const status = urlParams.get('status');
      const message = urlParams.get('message');
      const error = urlParams.get('error');

      const statusDiv = document.getElementById('status');
      const messageDiv = document.getElementById('message');

      // Handle success
      if (status === 'success') {
        statusDiv.className = 'success';
        statusDiv.textContent = '✓ Discord Connected Successfully';
        messageDiv.textContent = message || 'You can close this window.';
        
        // Notify parent and close
        if (window.opener) {
          window.opener.postMessage({ type: 'DISCORD_OAUTH_SUCCESS' }, '*');
          setTimeout(() => window.close(), 1000);
        } else {
          // Mobile deep link fallback
          setTimeout(() => {
            window.location.href = 'apex://discord-connected';
          }, 2000);
        }
      }
      // Handle error
      else if (status === 'error' || error) {
        statusDiv.className = 'error';
        statusDiv.textContent = '✗ Connection Failed';
        messageDiv.textContent = message || error || 'The Discord connection failed.';
        
        // Notify parent and close
        if (window.opener) {
          window.opener.postMessage({ 
            type: 'DISCORD_OAUTH_ERROR', 
            error: error || message || 'connection_failed' 
          }, '*');
          setTimeout(() => window.close(), 2000);
        } else {
          setTimeout(() => window.close(), 2000);
        }
      }
      // No status parameter (shouldn't happen)
      else {
        statusDiv.className = 'error';
        statusDiv.textContent = '✗ Invalid Request';
        messageDiv.textContent = 'Missing status parameter.';
        setTimeout(() => window.close(), 2000);
      }
    </script>
  </body>
</html>
